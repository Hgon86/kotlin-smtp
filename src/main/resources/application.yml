spring:
  application:
    name: kotlin-smtp
  main:
    web-application-type: none

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true

smtp:
  port: 2525 # listeners 미설정 시 단일 포트로 동작
  hostname: crinity
  serviceName: ESMTP

  # 리스너(포트)별 정책 분리(기능 구현 우선)
  # listeners를 지정하면 smtp.port 대신 이 목록을 사용합니다.
  # listeners:
  #   # MTA 수신(25/2525 등): opportunistic STARTTLS, AUTH 선택
  #   - port: 2525
  #     serviceName: ESMTP
  #     implicitTls: false
  #     proxyProtocol: false # LB/HAProxy 뒤라면 true + smtp.proxy.trustedCidrs 설정
  #     enableStartTls: true
  #     enableAuth: true
  #     requireAuthForMail: false
  #   # Submission(587): STARTTLS + AUTH 강제 권장
  #   - port: 587
  #     serviceName: SUBMISSION
  #     implicitTls: false
  #     proxyProtocol: false # LB/HAProxy 뒤라면 true + smtp.proxy.trustedCidrs 설정
  #     enableStartTls: true
  #     enableAuth: true
  #     requireAuthForMail: true
  #   # SMTPS(465): implicit TLS + AUTH 강제 권장
  #   - port: 465
  #     serviceName: SMTPS
  #     implicitTls: true
  #     proxyProtocol: false # SMTPS도 PROXY 헤더가 TLS보다 먼저 오므로 true 가능(단, 신뢰 프록시 필수)
  #     enableStartTls: false
  #     enableAuth: true
  #     requireAuthForMail: true

  # PROXY protocol(v1) 신뢰 프록시 CIDR 목록
  # - 보안상 필수: PROXY 헤더는 스푸핑이 가능하므로, LB/HAProxy 등 "신뢰 가능한 프록시"에서만 수용해야 합니다.
  proxy:
    trustedCidrs:
      - 127.0.0.1/32
      - ::1/128

  # 로컬 저장소(메일박스/임시파일) 경로
  storage:
    mailboxDir: C:\smtp-server\mailboxes
    tempDir: C:\smtp-server\temp-mails
    listsDir: C:\smtp-server\lists # EXPN 로컬 리스트(기능 우선; 운영에서는 DB/Directory로 이관 TODO)

  ssl:
    enabled: false # SSL/TLS 사용 여부
    certChainFile: /path/to/cert # 인증서 체인 파일 경로
    privateKeyFile: /path/to/key # 개인 키 파일 경로

  # 릴레이(외부 도메인 전달) 설정
  # - 인터넷 노출 시에는 오픈 릴레이 방지를 위해 requireAuthForRelay=true 권장
  relay:
    enabled: false
    localDomain: mydomain.com
    allowedSenderDomains: [] # 인증 없는 릴레이를 허용할 발신 도메인(비우면 제한 없음)
    requireAuthForRelay: true
    outboundTls:
      ports: [25] # 운영 기본은 25. 개발환경에서만 [25, 587] 등으로 확장 권장
      startTlsEnabled: true # 기본: opportunistic STARTTLS
      startTlsRequired: false # true면 상대방이 STARTTLS 미지원 시 전달 실패 가능
      checkServerIdentity: true
      trustAll: false # 개발환경에서만 true 권장(운영에서는 false)
      trustHosts: [] # 예: ["mx.example.com"]
      connectTimeoutMs: 15000
      readTimeoutMs: 15000

  # 스풀러 기본 설정
  spool:
    dir: C:\smtp-server\spool
    maxRetries: 5
    retryDelaySeconds: 60

  auth:
    enabled: true
    required: false
    users:
      user: password
      secure: "$2a$10$CwTycUXWue0Thq9StjUM0uJ8ZrYcGQpFvWY9Y1KfK1aG1H0a4V/2m"

  # Rate Limiting 설정 (스팸 및 DoS 방지)
  rateLimit:
    maxConnectionsPerIp: 10 # IP당 최대 동시 연결 수
    maxMessagesPerIpPerHour: 100 # IP당 시간당 최대 메시지 수

  # 기능 플래그(인터넷 노출 기본값은 보수적으로 off)
  features:
    vrfyEnabled: false
    etrnEnabled: false
    expnEnabled: false

logging:
  level:
    root: info
    com.crinity.kotlinsmtp: info
